<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8">
    <title>Pong Game</title>
    <link rel="stylesheet" type="text/css" href="style.css" media="all">
  </head>
  <body>
    <canvas id="canvas" width="600" height="300"></canvas>

    <script type="text/javascript">
const canvas = document.querySelector("canvas");
const ctx = canvas.getContext("2d"); //wywołanie metody

canvas.width = 1000;
canvas.height = 500;

//wielkośc canvas
const cw = canvas.width; //utworzenie zmiennej canvas width
const ch = canvas.height; //utworzenie zmiennej canvas height

//wielkość piłki
const ballR = 15;

//pozycja piłki
let ballX = cw / 2 - ballR / 2;
let ballY = ch / 2 - ballR / 2;

//wielkość paletek
const paddleWidth = 20;
const paddleHeight = 100;

//pozycja paletek
//gracz
const playerX = 70;
let playerY = 200;
//AI
const aiX = 910;
let aiY = 200;

//wielkość linii środkowych
const lineWidth = 6;
const lineHeight = 20;

//prędkośc piłki
let plusOrMinus = Math.random() < 0.5 ? -1 : 1;
let ballSpeedX = plusOrMinus * 4;
plusOrMinus = Math.random() < 0.5 ? -1 : 1;
let ballSpeedY = plusOrMinus * Math.round(Math.random() * 3 + 1);

function player() {
  //gracz
  ctx.fillStyle = "orange";
  ctx.fillRect(playerX, playerY, paddleWidth, paddleHeight);
}

function ai() {
  //ai
  ctx.fillStyle = "red";
  ctx.fillRect(aiX, aiY, paddleWidth, paddleHeight);
}

function ball() {
  const middleBall = ballY + ballR;
  const middlePaddleP = playerY + paddleHeight / 2;
  const middlePaddleAI = aiY + paddleHeight / 2;
  //piłka
  ctx.beginPath();
  ctx.arc(ballX,ballY,ballR,0*Math.PI,2*Math.PI);
  ctx.strokeStyle = 'white';
  ctx.stroke();
  ctx.fillStyle = 'white';
  ctx.fill();
  ballX += ballSpeedX;
  ballY += ballSpeedY;
  //rozpoznawanie krawędzi
  if (ballY - ballR <= 0 || ballY + ballR >= ch) {
    ballSpeedY = -ballSpeedY;
    speedUp();
  }
  /*if(ballX<=0 || (ballX+ballR)>=cw){
        ballSpeedX=-ballSpeedX;
        speedUp();
    }*/
  if (ballX - ballR <= 0 || ballX + ballR >= cw) {
    ballX = cw / 2 - ballR /2;
    ballY = ch / 2 - ballR /2;

    plusOrMinus = Math.random() < 0.5 ? -1 : 1;
    ballSpeedX = plusOrMinus * 4;
    plusOrMinus = Math.random() < 0.5 ? -1 : 1;
    ballSpeedY = plusOrMinus * Math.round(Math.random() * 3 + 1);}


      /*if(middleBall>=middlePaddleP){
                console.log("dol");
            }
            if(middleBall<=middlePaddleP){
                console.log("gora")
            }*/

            if (ballX > 50 && ballX - ballR < 90) {
              if (middleBall >= middlePaddleP - 50 - ballR / 2 &&
                  middleBall <= middlePaddleP + 50 - ballR / 2){
                    ballSpeedX = -ballSpeedX;
                    speedUp();
              }
            }
            if (ballX > 890 && ballX < 930) {
              if (middleBall >= middlePaddleAI - 50 - ballR / 2 &&
                middleBall <= middlePaddleAI + 50 + ballR / 2){
                ballSpeedX = -ballSpeedX;
                speedUp();
              }
            }
}

function table() {
  //stół
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, cw, ch); //wartośc początkowa na osi x, wartośc początkowa na osi y, długośc(ile pikseli na osi x), szerokośc(ile pikseli na osi y)
  //linie na środku
  ctx.fillStyle = "gray";
  for (
    let linePosition = 20;
    linePosition < ch;
    linePosition += 2 * lineHeight
  ) {
    ctx.fillRect(cw / 2 - lineWidth / 2, linePosition, lineWidth, lineHeight);
  }
}

function game() {
  table();
  ball();
  player();
  ai();
}

setInterval(game, 1000 / 60);

topCanvas = canvas.offsetTop;
console.log("topCanvas")

//pozycja kursora
//e - informacje o położeniu myszy
function playerPosition(e) {
	//console.log("pozycja myszy to" + (e.clientY - topCanvas))
  playerY = e.clientY - topCanvas - paddleHeight / 2;

  //zabezpieczenie przed wyjechaniem paletki poza canvas
  if (playerY >= ch - paddleHeight) {
    playerY = ch - paddleHeight;
  }
  if (playerY <= 0) {
    playerY = 0;
  }
}

//przyspieszenie
function speedUp() {
  //prędkość X
  if (ballSpeedX > 0 && ballSpeedX < 16) {
    ballSpeedX += .4;
  } else if (ballSpeedX < 0 && ballSpeedX > -16) {
    ballSpeedX -= .4;
  }
  //prędkośc Y
  if (ballSpeedY > 0 && ballSpeedY < 16) {
    ballSpeedY += .4;
  } else if (ballSpeedY < 0 && ballSpeedY > -16) {
    ballSpeedY -= .4;
  }
}
const move = (e) => {
  console.log(e.keyCode)
  //góra: 38, dół: 40,
  switch(e.keyCode){
  //strzałka w górę
    case 38:
      aiY = aiY - 40;
      if(aiY < 0){
        aiY = 0
      }
      break;
  }
  //strzałka w dół
  switch(e.keyCode){
    case 40:
      aiY = aiY + 40;
      if(aiY > ch - paddleHeight){
        aiY = ch - paddleHeight;
      }
      break;
  }
}
//sterowanie paddle za pomocą myszy
canvas.addEventListener("mousemove", playerPosition);
window.addEventListener("keydown", move);

    </script>

  </body>
</html>
